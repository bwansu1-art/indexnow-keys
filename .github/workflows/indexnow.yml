name: 'Auto IndexNow Submit'

on:
  schedule:
    - cron: '0 9,21 * * *'  # ë§¤ì¼ ì˜¤ì „ 9ì‹œ, ë°¤ 9ì‹œ
  workflow_dispatch:        # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

jobs:
  submit:
    runs-on: ubuntu-latest
    steps:
      - name: Submit Recent Posts to IndexNow
        run: |
          echo "ğŸš€ Starting IndexNow submission..."
          
          # ìµœê·¼ í¬ìŠ¤íŠ¸ URL ê°€ì ¸ì˜¤ê¸° (ìµœëŒ€ 5ê°œ)
          urls=$(curl -s "https://www.myperfectview.com/sitemap.xml" | grep -o 'https://www\.myperfectview\.com[^<]*' | head -5)
          
          echo "ğŸ“‹ URLs to submit:"
          echo "$urls"
          
          # URLë“¤ì„ JSON ë°°ì—´ë¡œ ë³€í™˜
          url_list=$(echo "$urls" | sed 's/.*/"&"/' | paste -sd ',' -)
          
          # IndexNowì— ì¼ê´„ ì œì¶œ
          echo "ğŸ“¤ Submitting to IndexNow..."
          curl -X POST "https://api.indexnow.org/indexnow" \
            -H "Content-Type: application/json" \
            -d "{\"host\":\"www.myperfectview.com\",\"key\":\"${{ secrets.INDEXNOW_KEY }}\",\"urlList\":[$url_list]}"
          
          echo "âœ… Submission completed!"
