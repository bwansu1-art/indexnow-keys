name: 'SubsidyBB IndexNow Submit'

on:
  schedule:
    - cron: '0 10,22 * * *'  # 오전 10시, 밤 10시 (기존과 다른 시간)
  workflow_dispatch:

jobs:
  submit:
    runs-on: ubuntu-latest
    steps:
      - name: Submit SubsidyBB to IndexNow
        run: |
          echo "🚀 Starting IndexNow for SubsidyBB..."
          
          # SubsidyBB URL들 가져오기
          urls=$(curl -s "https://www.subsidybb.kr/sitemap.xml" | grep -o 'https://www\.subsidybb\.kr[^<]*' | head -5)
          
          echo "📋 URLs to submit:"
          echo "$urls"
          
          if [ -n "$urls" ]; then
            url_list=$(echo "$urls" | sed 's/.*/"&"/' | paste -sd ',' -)
            
            echo "📤 Submitting to IndexNow..."
            curl -X POST "https://api.indexnow.org/indexnow" \
              -H "Content-Type: application/json" \
              -d "{\"host\":\"www.subsidybb.kr\",\"key\":\"${{ secrets.INDEXNOW_KEY }}\",\"urlList\":[$url_list]}"
            
            echo "✅ SubsidyBB submission completed!"
          else
            echo "⚠️ No URLs found in sitemap"
          fi
