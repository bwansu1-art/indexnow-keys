name: 'SubsidyBB IndexNow Submit'

on:
  schedule:
    - cron: '0 10,22 * * *'  # ì˜¤ì „ 10ì‹œ, ë°¤ 10ì‹œ (ê¸°ì¡´ê³¼ ë‹¤ë¥¸ ì‹œê°„)
  workflow_dispatch:

jobs:
  submit:
    runs-on: ubuntu-latest
    steps:
      - name: Submit SubsidyBB to IndexNow
        run: |
          echo "ðŸš€ Starting IndexNow for SubsidyBB..."
          
          # SubsidyBB URLë“¤ ê°€ì ¸ì˜¤ê¸°
          urls=$(curl -s "https://www.subsidybb.kr/sitemap.xml" | grep -o 'https://www\.subsidybb\.kr[^<]*' | head -5)
          
          echo "ðŸ“‹ URLs to submit:"
          echo "$urls"
          
          if [ -n "$urls" ]; then
            url_list=$(echo "$urls" | sed 's/.*/"&"/' | paste -sd ',' -)
            
            echo "ðŸ“¤ Submitting to IndexNow..."
            curl -X POST "https://api.indexnow.org/indexnow" \
              -H "Content-Type: application/json" \
              -d "{\"host\":\"www.subsidybb.kr\",\"key\":\"${{ secrets.INDEXNOW_KEY }}\",\"urlList\":[$url_list]}"
            
            echo "âœ… SubsidyBB submission completed!"
          else
            echo "âš ï¸ No URLs found in sitemap"
          fi
